# Phase 3 실행표: 동기화/충돌 정책 (비개발자용)

이동: [Master Plan](./master-plan.md) | 이전: [Phase 2](./phase-2-cloud-db-execution.md) | 다음: [Phase 4](./phase-4-ai-ops-execution.md)

## 1) 이 문서의 목적

- Phase 2에서 서버 원본 전환을 했다면, 이제 "오프라인/온라인 전환 중 데이터가 꼬이지 않게" 만드는 단계입니다.
- 쉽게 말해, 사용자가 네트워크가 불안정해도 기록이 사라지거나 중복되지 않게 하는 실행 계획입니다.

## 2) Phase 3 최종 목표 (다시 확인)

- 오프라인 상태에서 만든 데이터가 온라인 복구 후 정상 동기화
- 중복 저장/덮어쓰기 충돌 최소화
- 사용자 관점에서 데이터 일관성 유지

## 3) 역할 정의 (Who)

- PM/PO: 사용자 경험 기준(충돌 시 보여줄 메시지) 확정
- Backend Lead: idempotency/버전 검증/충돌 처리 정책 구현
- Mobile Lead: sync queue/재시도/상태 표시 구현
- QA: 오프라인/온라인 복귀 시나리오 전수 점검
- DevOps: 동기화 실패율/지연 모니터링 지표 적용

## 4) 주차별 실행표 (When / What)

### Week 1 (정책 확정 주간)

- PM/PO
  - 충돌 정책 승인:
    - 어떤 데이터는 서버 최신 우선
    - 어떤 데이터는 사용자 최신 입력 우선
- Backend Lead
  - idempotency key 규칙 정의 (UUID v4 기준)
  - **Conflict Resolution 정책**:
    - 기본: **Last-Write-Wins (LWW)** (서버 수신 시간 기준)
    - 중요 데이터(알레르기 등): **Manual Merge** (클라이언트에게 충돌 알림 후 사용자 선택)
  - 요청 버전(version/timestamp) 처리 규칙 정의
- Mobile Lead
  - sync queue 상태 모델 설계 (pending/sending/failed/synced)
  - 사용자 안내 UX 설계 (동기화 중/실패/재시도)
- QA
  - 테스트 케이스 설계:
    - 오프라인 작성
    - 중간 끊김
    - 재접속 후 자동 동기화
- 완료 체크
  - [ ] 충돌 정책 문서 승인
  - [ ] idempotency 규칙 확정
  - [ ] 큐 상태 모델 승인

### Week 2 (구현 주간)

- Backend Lead
  - 중복 요청 차단(idempotency) 적용
  - 충돌 감지/해결 로직 구현
- Mobile Lead
  - sync queue 구현
  - 실패 시 지수 백오프 재시도
  - 수동 재시도 버튼/오류 안내 연결
- DevOps
  - 동기화 지표 대시보드 구성:
    - 실패율
    - 평균 재시도 횟수
    - 동기화 지연시간
- 완료 체크
  - [ ] 오프라인 입력이 큐에 저장
  - [ ] 온라인 복귀 시 자동 전송
  - [ ] 중복 저장 차단 확인

### Week 3 (안정화/검증 주간)

- QA
  - 전수 시나리오 실행:
    - 비행기 모드 on/off
    - 약한 네트워크 환경
    - 동일 항목 빠른 연속 수정
  - 실패 로그 수집 및 재현성 확인
- Mobile Lead + Backend Lead
  - 실패 상위 패턴 수정
  - 사용자 메시지 개선
- PM/PO
  - Go/No-Go 판단
- 완료 체크
  - [ ] 데이터 유실 0건
  - [ ] 중복 저장 0건
  - [ ] 복구 시 동기화 성공률 목표 달성

## 5) 비개발자용 "주간 점검 질문" (매주 15분)

- Q1. 오프라인에서 작성한 데이터가 100% 복구되나요?
- Q2. 동기화 실패 시 사용자는 어떤 안내를 보나요?
- Q3. 중복 저장이 실제로 막혔나요?
- Q4. 실패율이 목표치 이하인가요?

## 6) 수용 기준 (Definition of Done)

- 기능 기준:
  - 오프라인 입력 -> 온라인 복귀 후 자동 동기화 성공
  - 실패 항목 재시도 성공
  - 중복 요청 차단 동작
- 품질 기준:
  - 유실/중복 0건
  - 동기화 실패율 목표치 이하
  - request_id/user_id 기준 문제 추적 가능

## 7) 리스크와 대응 (쉽게 설명)

- 리스크 1: 같은 요청이 여러 번 서버에 들어감
  - 대응: idempotency key로 "한 번만 반영" 보장
- 리스크 2: 오프라인 중 수정한 내용이 덮어써짐
  - 대응: 충돌 정책(버전 비교) 적용
- 리스크 3: 실패가 반복되어 사용자가 불신
  - 대응: 실패 상태 명확 표기 + 수동 재시도 제공

## 8) 이번 단계에서 하지 않는 것 (범위 보호)

- AI 모델 품질 개선(Phase 4)
- 법무/보안 삭제 자동화(Phase 5)
- 인증 공급자 추가 확장(Phase 1 범위 외)

---

문서 버전: v1.0  
연결 문서: [Master Plan](./master-plan.md), [Phase 2 실행표](./phase-2-cloud-db-execution.md), [API 계약 기준서](../contracts/api-contracts.md)  
최종 수정: 2026-02-19
